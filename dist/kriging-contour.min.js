// kriging-contour v1.0.2 Copyright 2020 freegis
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).kriging=t.kriging||{})}(this,(function(t){"use strict";function e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var r,n;1===(r=e).length&&(n=r,r=function(t,r){return e(n(t),r)});var o=Math.sqrt(50),i=Math.sqrt(10),a=Math.sqrt(2);function s(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1}var u=Array.prototype.slice;function l(t,e){return t-e}function h(t){return function(){return t}}function f(t,e){for(var r,n=-1,o=e.length;++n<o;)if(r=c(t,e[n]))return r;return 0}function c(t,e){for(var r=e[0],n=e[1],o=-1,i=0,a=t.length,s=a-1;i<a;s=i++){var u=t[i],l=u[0],h=u[1],f=t[s],c=f[0],p=f[1];if(g(u,f,e))return 0;h>n!=p>n&&r<(c-l)*(n-h)/(p-h)+l&&(o=-o)}return o}function g(t,e,r){var n,o,i,a;return function(t,e,r){return(e[0]-t[0])*(r[1]-t[1])==(r[0]-t[0])*(e[1]-t[1])}(t,e,r)&&(o=t[n=+(t[0]===e[0])],i=r[n],a=e[n],o<=i&&i<=a||a<=i&&i<=o)}function p(){}var d=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function m(){var t=1,e=1,r=s,n=y;function c(t){var e=r(t);if(Array.isArray(e))e=e.slice().sort(l);else{var n=function(t,e){var r,n,o,i=t.length,a=-1;if(null==e){for(;++a<i;)if(null!=(r=t[a])&&r>=r)for(n=o=r;++a<i;)null!=(r=t[a])&&(n>r&&(n=r),o<r&&(o=r))}else for(;++a<i;)if(null!=(r=e(t[a],a,t))&&r>=r)for(n=o=r;++a<i;)null!=(r=e(t[a],a,t))&&(n>r&&(n=r),o<r&&(o=r));return[n,o]}(t),s=n[0],u=n[1];e=function(t,e,r){var n=Math.abs(e-t)/Math.max(0,r),s=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),u=n/s;return u>=o?s*=10:u>=i?s*=5:u>=a&&(s*=2),e<t?-s:s}(s,u,e),e=function(t,e,r){t=+t,e=+e,r=(o=arguments.length)<2?(e=t,t=0,1):o<3?1:+r;for(var n=-1,o=0|Math.max(0,Math.ceil((e-t)/r)),i=new Array(o);++n<o;)i[n]=t+n*r;return i}(Math.floor(s/e)*e,Math.floor(u/e)*e,e)}return e.map((function(e){return g(t,e)}))}function g(r,o){var i=[],a=[];return function(r,n,o){var i,a,s,u,l,h,f=new Array,c=new Array;i=a=-1,u=r[0]>=n,d[u<<1].forEach(g);for(;++i<t-1;)s=u,u=r[i+1]>=n,d[s|u<<1].forEach(g);d[u<<0].forEach(g);for(;++a<e-1;){for(i=-1,u=r[a*t+t]>=n,l=r[a*t]>=n,d[u<<1|l<<2].forEach(g);++i<t-1;)s=u,u=r[a*t+t+i+1]>=n,h=l,l=r[a*t+i+1]>=n,d[s|u<<1|l<<2|h<<3].forEach(g);d[u|l<<3].forEach(g)}i=-1,l=r[a*t]>=n,d[l<<2].forEach(g);for(;++i<t-1;)h=l,l=r[a*t+i+1]>=n,d[l<<2|h<<3].forEach(g);function g(t){var e,r,n=[t[0][0]+i,t[0][1]+a],s=[t[1][0]+i,t[1][1]+a],u=m(n),l=m(s);(e=c[u])?(r=f[l])?(delete c[e.end],delete f[r.start],e===r?(e.ring.push(s),o(e.ring)):f[e.start]=c[r.end]={start:e.start,end:r.end,ring:e.ring.concat(r.ring)}):(delete c[e.end],e.ring.push(s),c[e.end=l]=e):(e=f[l])?(r=c[u])?(delete f[e.start],delete c[r.end],e===r?(e.ring.push(s),o(e.ring)):f[r.start]=c[e.end]={start:r.start,end:e.end,ring:r.ring.concat(e.ring)}):(delete f[e.start],e.ring.unshift(n),f[e.start=u]=e):f[u]=c[l]={start:u,end:l,ring:[n,s]}}d[l<<3].forEach(g)}(r,o,(function(t){n(t,r,o),function(t){for(var e=0,r=t.length,n=t[r-1][1]*t[0][0]-t[r-1][0]*t[0][1];++e<r;)n+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return n}(t)>0?i.push([t]):a.push(t)})),a.forEach((function(t){for(var e,r=0,n=i.length;r<n;++r)if(-1!==f((e=i[r])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:o,coordinates:i}}function m(e){return 2*e[0]+e[1]*(t+1)*4}function y(r,n,o){r.forEach((function(r){var i,a=r[0],s=r[1],u=0|a,l=0|s,h=n[l*t+u];a>0&&a<t&&u===a&&(i=n[l*t+u-1],r[0]=a+(o-i)/(h-i)-.5),s>0&&s<e&&l===s&&(i=n[(l-1)*t+u],r[1]=s+(o-i)/(h-i)-.5)}))}return c.contour=g,c.size=function(r){if(!arguments.length)return[t,e];var n=Math.ceil(r[0]),o=Math.ceil(r[1]);if(!(n>0&&o>0))throw new Error("invalid size");return t=n,e=o,c},c.thresholds=function(t){return arguments.length?(r="function"==typeof t?t:Array.isArray(t)?h(u.call(t)):h(t),c):r},c.smooth=function(t){return arguments.length?(n=t?y:p,c):n===y},c}function y(t,e){var r,n=[0].rep(e*e);for(r=0;r<e;r++)n[r*e+r]=t;return n}function v(t,e,r,n){var o,i,a=Array(r*n);for(o=0;o<r;o++)for(i=0;i<n;i++)a[o*n+i]=t[o*n+i]+e[o*n+i];return a}function w(t,e,r,n,o){var i,a,s,u=Array(r*o);for(i=0;i<r;i++)for(a=0;a<o;a++)for(u[i*o+a]=0,s=0;s<n;s++)u[i*o+a]+=t[i*n+s]*e[s*o+a];return u}function b(t,e){var r,n,o,i=Array(e);for(r=0;r<e;r++)i[r]=t[r*e+r];for(r=0;r<e;r++){for(n=0;n<r;n++)i[r]-=t[r*e+n]*t[r*e+n];if(i[r]<=0)return!1;for(i[r]=Math.sqrt(i[r]),n=r+1;n<e;n++){for(o=0;o<r;o++)t[n*e+r]-=t[n*e+o]*t[r*e+o];t[n*e+r]/=i[r]}}for(r=0;r<e;r++)t[r*e+r]=i[r];return!0}function E(t,e){var r,n,o,i;for(r=0;r<e;r++)for(t[r*e+r]=1/t[r*e+r],n=r+1;n<e;n++){for(i=0,o=r;o<n;o++)i-=t[n*e+o]*t[o*e+r];t[n*e+r]=i/t[n*e+n]}for(r=0;r<e;r++)for(n=r+1;n<e;n++)t[r*e+n]=0;for(r=0;r<e;r++){for(t[r*e+r]*=t[r*e+r],o=r+1;o<e;o++)t[r*e+r]+=t[o*e+r]*t[o*e+r];for(n=r+1;n<e;n++)for(o=n;o<e;o++)t[r*e+n]+=t[o*e+r]*t[o*e+n]}for(r=0;r<e;r++)for(n=0;n<r;n++)t[r*e+n]=t[n*e+r]}function M(t,e){var r,n,o,i,a,s,u,l,h,f,c,g=e,p=Array(e*e),d=Array(e),m=Array(e),y=Array(e);for(r=0;r<e;r++)for(i=0;i<e;i++)p[r*e+i]=r==i?1:0;for(i=0;i<e;i++)y[i]=0;for(r=0;r<e;r++){for(l=0,i=0;i<e;i++)if(1!=y[i])for(a=0;a<e;a++)0==y[a]&&Math.abs(t[i*e+a])>=l&&(l=Math.abs(t[i*e+a]),o=i,n=a);if(++y[n],o!=n){for(s=0;s<e;s++)c=t[o*e+s],t[o*e+s]=t[n*e+s],t[n*e+s]=c;for(s=0;s<g;s++)c=p[o*e+s],p[o*e+s]=p[n*e+s],p[n*e+s]=c}if(m[r]=o,d[r]=n,0==t[n*e+n])return!1;for(f=1/t[n*e+n],t[n*e+n]=1,s=0;s<e;s++)t[n*e+s]*=f;for(s=0;s<g;s++)p[n*e+s]*=f;for(u=0;u<e;u++)if(u!=n){for(h=t[u*e+n],t[u*e+n]=0,s=0;s<e;s++)t[u*e+s]-=t[n*e+s]*h;for(s=0;s<g;s++)p[u*e+s]-=p[n*e+s]*h}}for(s=e-1;s>=0;s--)if(m[s]!=d[s])for(a=0;a<e;a++)c=t[a*e+m[s]],t[a*e+m[s]]=t[a*e+d[s]],t[a*e+d[s]]=c;return!0}function A(t,e,r,n,o){return e+(n-e)/r*(1-Math.exp(-1/o*Math.pow(t/r,2)))}function R(t,e,r,n,o){return e+(n-e)/r*(1-Math.exp(-1/o*(t/r)))}function x(t,e,r,n,o){return t>r?e+(n-e)/r:e+(n-e)/r*(t/r*1.5-.5*Math.pow(t/r,3))}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var t,e;for(t=0,e=0;t<this.length;t++)e+=this[t];return e/this.length},Array.prototype.rep=function(t){for(var e=new Array(t),r=this[0],n=0;n<t;n++)e[n]=r;return e},Array.prototype.pip=function(t,e){var r,n,o=!1;for(r=0,n=this.length-1;r<this.length;n=r++)this[r][1]>e!=this[n][1]>e&&t<(this[n][0]-this[r][0])*(e-this[r][1])/(this[n][1]-this[r][1])+this[r][0]&&(o=!o);return o};var _={};_.train=function(t,e,r,n,o,i){var a={t:t,x:e,y:r,nugget:0,range:0,sill:0,A:1/3,n:0};switch(n){case"gaussian":a.model=A;break;case"exponential":a.model=R;break;case"spherical":a.model=x}var s,u,l,h,f=t.length,c=Array((f*f-f)/2);for(s=0,l=0;s<f;s++)for(u=0;u<s;u++,l++)c[l]=Array(2),c[l][0]=Math.pow(Math.pow(e[s]-e[u],2)+Math.pow(r[s]-r[u],2),.5),c[l][1]=Math.abs(t[s]-t[u]);c.sort((function(t,e){return t[0]-e[0]})),a.range=c[(f*f-f)/2-1][0];var g=(f*f-f)/2>30?30:(f*f-f)/2,p=a.range/g,d=[0].rep(g),m=[0].rep(g);if(g<30)for(h=0;h<g;h++)d[h]=c[h][0],m[h]=c[h][1];else{for(s=0,u=0,l=0,h=0;s<g&&u<(f*f-f)/2;s++,l=0){for(;c[u][0]<=(s+1)*p&&(d[h]+=c[u][0],m[h]+=c[u][1],l++,!(++u>=(f*f-f)/2)););l>0&&(d[h]/=l,m[h]/=l,h++)}if(h<2)return a}f=h,a.range=d[f-1]-d[0];var _=[1].rep(2*f),k=Array(f),T=a.A;for(s=0;s<f;s++){switch(n){case"gaussian":_[2*s+1]=1-Math.exp(-1/T*Math.pow(d[s]/a.range,2));break;case"exponential":_[2*s+1]=1-Math.exp(-1/T*d[s]/a.range);break;case"spherical":_[2*s+1]=d[s]/a.range*1.5-.5*Math.pow(d[s]/a.range,3)}k[s]=m[s]}var P=function(t,e,r){var n,o,i=Array(r*e);for(n=0;n<e;n++)for(o=0;o<r;o++)i[o*e+n]=t[n*r+o];return i}(_,f,2),O=w(P,_,2,f,2),I=(O=v(O,y(1/i,2),2,2)).slice(0);b(O,2)?E(O,2):(M(I,2),O=I);var S=w(w(O,P,2,2,f),k,2,f,1);a.nugget=S[0],a.sill=S[1]*a.range+a.nugget,a.n=e.length,f=e.length;var j=Array(f*f);for(s=0;s<f;s++){for(u=0;u<s;u++)j[s*f+u]=a.model(Math.pow(Math.pow(e[s]-e[u],2)+Math.pow(r[s]-r[u],2),.5),a.nugget,a.range,a.sill,a.A),j[u*f+s]=j[s*f+u];j[s*f+s]=a.model(0,a.nugget,a.range,a.sill,a.A)}var C=v(j,y(o,f),f,f),L=C.slice(0);b(C,f)?E(C,f):(M(L,f),C=L);j=C.slice(0);var F=w(C,t,f,f,1);return a.K=j,a.M=F,a},_.predict=function(t,e,r){var n,o=Array(r.n);for(n=0;n<r.n;n++)o[n]=r.model(Math.pow(Math.pow(t-r.x[n],2)+Math.pow(e-r.y[n],2),.5),r.nugget,r.range,r.sill,r.A);return w(o,r.M,1,r.n,1)[0]},_.variance=function(t,e,r){var n,o=Array(r.n);for(n=0;n<r.n;n++)o[n]=r.model(Math.pow(Math.pow(t-r.x[n],2)+Math.pow(e-r.y[n],2),.5),r.nugget,r.range,r.sill,r.A);return r.model(0,r.nugget,r.range,r.sill,r.A)+w(w(o,r.K,1,r.n,r.n),o,1,r.n,1)[0]},_.getGridInfo=function(t,e,r){var n=[],o=[t[0],t[2]],i=[t[1],t[3]],a=[e.t.min(),e.t.max()],s=o[1]-o[0],u=i[1]-i[0];let l,h;l=r?Math.ceil(r):200,h=Math.ceil(l/(s/u));var f,c,g=1*s/l,p=1*u/h;for(let r=0;r<h;r++)for(let o=0;o<l;o++)f=t[0]+o*g,c=t[1]+r*p,n.push(_.predict(f,c,e));return{grid:n,n:l,m:h,xlim:o,ylim:i,zlim:a,x_resolution:g,y_resolution:p}},_.getVectorContour=function(t,e){var r=m().size([t.n,t.m]).thresholds(e)(t.grid);let n={type:"FeatureCollection",features:[]};var o=t.xlim[1]-t.xlim[0],i=t.ylim[1]-t.ylim[0];return r.forEach(e=>{e.coordinates.forEach(r=>{let a=r.map(e=>e.map((function(e){return[t.xlim[0]+o*(1*e[0]/t.n),t.ylim[0]+i*(1*e[1]/t.m)]})));n.features.push({type:"Feature",properties:{contour_value:e.value},geometry:{type:"Polygon",coordinates:a}})})}),n},_.drawCanvasContour=function(t,e,r,n,o){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height);var a=[r[1]-r[0],n[1]-n[0],t.zlim[1]-t.zlim[0]],s=t.n,u=t.m,l=Math.ceil(t.x_resolution*e.width/(r[1]-r[0])),h=Math.ceil(t.y_resolution*e.height/(n[1]-n[0]));for(let f=0;f<u;f++)for(let u=0;u<s;u++){let c=f*s+u;if(null==t.grid[c])continue;let g=e.width*(u*t.x_resolution+t.xlim[0]-r[0])/a[0],p=e.height*(1-(f*t.y_resolution+t.ylim[0]-n[0])/a[1]),d=(t.grid[c]-t.zlim[0])/a[2];d<0?d=0:d>1&&(d=1),i.fillStyle=o[Math.floor((o.length-1)*d)],i.fillRect(Math.round(g-l/2),Math.round(p-h/2),l,h)}};var k="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function T(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function P(t,e){return t(e={exports:{}},e.exports),e.exports}var O=P((function(t,e){function r(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,n){return void 0===n&&(n={}),r({type:"Point",coordinates:t},e,n)}function o(t,e,n){void 0===n&&(n={});for(var o=0,i=t;o<i.length;o++){var a=i[o];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:t},e,n)}function i(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:t},e,n)}function a(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function s(t,e,n){return void 0===n&&(n={}),r({type:"MultiLineString",coordinates:t},e,n)}function u(t,e,n){return void 0===n&&(n={}),r({type:"MultiPoint",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),r({type:"MultiPolygon",coordinates:t},e,n)}function h(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t*n}function f(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t/n}function c(t){return 180*(t%(2*Math.PI))/Math.PI}function g(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius/1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1/1.0936},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=r,e.geometry=function(t,e,r){switch(t){case"Point":return n(e).geometry;case"LineString":return i(e).geometry;case"Polygon":return o(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},e.point=n,e.points=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return n(t,e)})),r)},e.polygon=o,e.polygons=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return o(t,e)})),r)},e.lineString=i,e.lineStrings=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return i(t,e)})),r)},e.featureCollection=a,e.multiLineString=s,e.multiPoint=u,e.multiPolygon=l,e.geometryCollection=function(t,e,n){return void 0===n&&(n={}),r({type:"GeometryCollection",geometries:t},e,n)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},e.radiansToLength=h,e.lengthToRadians=f,e.lengthToDegrees=function(t,e){return c(f(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=c,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return h(f(t,e),r)},e.convertArea=function(t,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var o=e.areaFactors[r];if(!o)throw new Error("invalid original units");var i=e.areaFactors[n];if(!i)throw new Error("invalid final units");return t/o*i},e.isNumber=g,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!g(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")},e.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},e.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},e.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},e.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},e.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},e.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},e.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}}));T(O);O.earthRadius,O.factors,O.unitsFactors,O.areaFactors,O.feature,O.geometry,O.point,O.points,O.polygon,O.polygons,O.lineString,O.lineStrings,O.featureCollection,O.multiLineString,O.multiPoint,O.multiPolygon,O.geometryCollection,O.round,O.radiansToLength,O.lengthToRadians,O.lengthToDegrees,O.bearingToAzimuth,O.radiansToDegrees,O.degreesToRadians,O.convertLength,O.convertArea,O.isNumber,O.isObject,O.validateBBox,O.validateId,O.radians2degrees,O.degrees2radians,O.distanceToDegrees,O.distanceToRadians,O.radiansToDistance,O.bearingToAngle,O.convertDistance;var I=P((function(t,e){function r(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,n){return void 0===n&&(n={}),r({type:"Point",coordinates:t},e,n)}function o(t,e,n){void 0===n&&(n={});for(var o=0,i=t;o<i.length;o++){var a=i[o];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:t},e,n)}function i(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:t},e,n)}function a(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function s(t,e,n){return void 0===n&&(n={}),r({type:"MultiLineString",coordinates:t},e,n)}function u(t,e,n){return void 0===n&&(n={}),r({type:"MultiPoint",coordinates:t},e,n)}function l(t,e,n){return void 0===n&&(n={}),r({type:"MultiPolygon",coordinates:t},e,n)}function h(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t*n}function f(t,r){void 0===r&&(r="kilometers");var n=e.factors[r];if(!n)throw new Error(r+" units is invalid");return t/n}function c(t){return 180*(t%(2*Math.PI))/Math.PI}function g(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:e.earthRadius/1.0936},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1/1.0936},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=r,e.geometry=function(t,e,r){switch(t){case"Point":return n(e).geometry;case"LineString":return i(e).geometry;case"Polygon":return o(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},e.point=n,e.points=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return n(t,e)})),r)},e.polygon=o,e.polygons=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return o(t,e)})),r)},e.lineString=i,e.lineStrings=function(t,e,r){return void 0===r&&(r={}),a(t.map((function(t){return i(t,e)})),r)},e.featureCollection=a,e.multiLineString=s,e.multiPoint=u,e.multiPolygon=l,e.geometryCollection=function(t,e,n){return void 0===n&&(n={}),r({type:"GeometryCollection",geometries:t},e,n)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},e.radiansToLength=h,e.lengthToRadians=f,e.lengthToDegrees=function(t,e){return c(f(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=c,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return h(f(t,e),r)},e.convertArea=function(t,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var o=e.areaFactors[r];if(!o)throw new Error("invalid original units");var i=e.areaFactors[n];if(!i)throw new Error("invalid final units");return t/o*i},e.isNumber=g,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!g(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")},e.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},e.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},e.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},e.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},e.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},e.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},e.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}}));T(I);I.earthRadius,I.factors,I.unitsFactors,I.areaFactors,I.feature,I.geometry,I.point,I.points,I.polygon,I.polygons,I.lineString,I.lineStrings,I.featureCollection,I.multiLineString,I.multiPoint,I.multiPolygon,I.geometryCollection,I.round,I.radiansToLength,I.lengthToRadians,I.lengthToDegrees,I.bearingToAzimuth,I.radiansToDegrees,I.degreesToRadians,I.convertLength,I.convertArea,I.isNumber,I.isObject,I.validateBBox,I.validateId,I.radians2degrees,I.degrees2radians,I.distanceToDegrees,I.distanceToRadians,I.radiansToDistance,I.bearingToAngle,I.convertDistance;var S=P((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.getCoord=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")},e.getCoords=function(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},e.containsNumber=function t(e){if(e.length>1&&I.isNumber(e[0])&&I.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return t(e[0]);throw new Error("coordinates must only contain numbers")},e.geojsonType=function(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)},e.featureOf=function(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)},e.collectionOf=function(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,o=t.features;n<o.length;n++){var i=o[n];if(!i||"Feature"!==i.type||!i.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!i.geometry||i.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+i.geometry.type)}},e.getGeom=function(t){return"Feature"===t.type?t.geometry:t},e.getType=function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}}));T(S);S.getCoord,S.getCoords,S.containsNumber,S.geojsonType,S.featureOf,S.collectionOf,S.getGeom,S.getType;function j(t,e){return t>e?1:t<e?-1:0}class C{constructor(t=j,e=!1){this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}rotateLeft(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e}rotateRight(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e}_splay(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}}splay(t){for(var e,r,n,o,i;t.parent;)(r=(e=t.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),o=t.left,i=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,e.right=r,r.parent=e):(o?(r.right=o,o.parent=r):r.right=null,t.left=r,r.parent=t)),i?(e.left=i,i.parent=e):e.left=null,t.right=e,e.parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,e.left=r,r.parent=e):(i?(r.left=i,i.parent=r):r.left=null,t.right=r,r.parent=t)),o?(e.right=o,o.parent=e):e.right=null,t.left=e,e.parent=t)}replace(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}insert(t,e){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===o(r.key,t))return;r=o(r.key,t)<0?r.right:r.left}else for(;r;)n=r,r=o(r.key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?o(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r}find(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else{if(!(n>0))return e;e=e.left}}return null}contains(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1}remove(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}removeNode(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0}erase(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,n=e.right,o=null;r&&(r.parent=null,o=this.maxNode(r),this.splay(o),this._root=o),n&&(r?o.right=n:this._root=n,n.parent=o),this._size--}}pop(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e}next(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e}prev(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e}forEach(t){for(var e=this._root,r=[],n=!1,o=0;!n;)e?(r.push(e),e=e.left):r.length>0?(t(e=r.pop(),o++),e=e.right):n=!0;return this}range(t,e,r,n){const o=[],i=this._compare;let a,s=this._root;for(;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),a=i(s.key,e),a>0)break;if(i(s.key,t)>=0&&r.call(n,s))return this;s=s.right}return this}keys(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r}values(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r}at(t){for(var e=this._root,r=[],n=!1,o=0;!n;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),o===t)return e;o++,e=e.right}else n=!0;return null}load(t=[],e=[],r=!1){if(0!==this._size)throw new Error("bulk-load: tree is not empty");const n=t.length;return r&&function t(e,r,n,o,i){if(n>=o)return;const a=e[n+o>>1];let s=n-1,u=o+1;for(;;){do{s++}while(i(e[s],a)<0);do{u--}while(i(e[u],a)>0);if(s>=u)break;let t=e[s];e[s]=e[u],e[u]=t,t=r[s],r[s]=r[u],r[u]=t}t(e,r,n,u,i),t(e,r,u+1,o,i)}(t,e,0,n-1,this._compare),this._root=function t(e,r,n,o,i){const a=i-o;if(a>0){const s=o+Math.floor(a/2),u=r[s],l=n[s],h={key:u,data:l,parent:e};return h.left=t(h,r,n,o,s),h.right=t(h,r,n,s+1,i),h}return null}(null,t,e,0,n),this._size=n,this}min(){var t=this.minNode(this._root);return t?t.key:null}max(){var t=this.maxNode(this._root);return t?t.key:null}isEmpty(){return null===this._root}get size(){return this._size}static createTree(t,e,r,n,o){return new C(r,o).load(t,e,n)}}function L(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!F(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=F(t,r)}function F(t,e){switch(t.type){case 0:switch(e){case 0:return!t.otherInOut;case 1:return t.otherInOut;case 2:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case 3:return!0}break;case 2:return 0===e||1===e;case 3:return 2===e;case 1:return!1}return!1}class N{constructor(t,e,r,n,o){this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}isBelow(t){const e=this.point,r=this.otherEvent.point;return this.left?(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])>0:(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])>0}isAbove(t){return!this.isBelow(t)}isVertical(){return this.point[0]===this.otherEvent.point[0]}clone(){const t=new N(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}function D(t,e){return t[0]===e[0]&&t[1]===e[1]}function z(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function q(t,e){const r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(t,e,r,n){if(t.left!==e.left)return t.left?1:-1;if(0!==z(r,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,r)}function G(t,e,r){const n=new N(e,!1,t,t.isSubject),o=new N(e,!0,t.otherEvent,t.isSubject);return D(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=o.contourId=t.contourId,q(o,t.otherEvent)>0&&(t.otherEvent.left=!0,o.left=!1),t.otherEvent.otherEvent=o,t.otherEvent=n,r.push(o),r.push(n),r}function B(t,e){return t[0]*e[1]-t[1]*e[0]}function V(t,e){return t[0]*e[0]+t[1]*e[1]}function J(t,e,r){const n=function(t,e,r,n,o){const i=[e[0]-t[0],e[1]-t[1]],a=[n[0]-r[0],n[1]-r[1]];function s(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}const u=[r[0]-t[0],r[1]-t[1]];let l=B(i,a),h=l*l;const f=V(i,i);if(h>0){const e=B(u,a)/l;if(e<0||e>1)return null;const n=B(u,i)/l;return n<0||n>1?null:0===e||1===e?o?null:[s(t,e,i)]:0===n||1===n?o?null:[s(r,n,a)]:[s(t,e,i)]}if(l=B(u,i),h=l*l,h>0)return null;const c=V(i,u)/f,g=c+V(i,a)/f,p=Math.min(c,g),d=Math.max(c,g);return p<=1&&d>=0?1===p?o?null:[s(t,p>0?p:0,i)]:0===d?o?null:[s(t,d<1?d:1,i)]:o&&0===p&&1===d?null:[s(t,p>0?p:0,i),s(t,d<1?d:1,i)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=n?n.length:0;if(0===o)return 0;if(1===o&&(D(t.point,e.point)||D(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return D(t.point,n[0])||D(t.otherEvent.point,n[0])||G(t,n[0],r),D(e.point,n[0])||D(e.otherEvent.point,n[0])||G(e,n[0],r),1;const i=[];let a=!1,s=!1;return D(t.point,e.point)?a=!0:1===q(t,e)?i.push(e,t):i.push(t,e),D(t.otherEvent.point,e.otherEvent.point)?s=!0:1===q(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),a&&s||a?(e.type=1,t.type=e.inOut===t.inOut?2:3,a&&!s&&G(i[1].otherEvent,i[0].point,r),2):s?(G(i[0],i[1].point,r),3):i[0]!==i[3].otherEvent?(G(i[0],i[1].point,r),G(i[1],i[2].point,r),3):(G(i[0],i[1].point,r),G(i[3].otherEvent,i[2].point,r),3)}function K(t,e){if(t===e)return 0;if(0!==z(t.point,t.otherEvent.point,e.point)||0!==z(t.point,t.otherEvent.point,e.otherEvent.point))return D(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===q(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;{let r=t.point,n=e.point;if(r[0]===n[0]&&r[1]===n[1])return r=t.otherEvent.point,n=e.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1}return 1===q(t,e)?1:-1}function $(t,e,r,n){let o=t+1;const i=e.length;if(o>i-1)return t-1;let a=e[t].point,s=e[o].point;for(;o<i&&s[0]===a[0]&&s[1]===a[1];){if(!r[o])return o;o++,s=e[o].point}for(o=t-1;r[o]&&o>=n;)o--;return o}function H(t,e){let r,n;const o=function(t){let e,r,n,o;const i=[];for(r=0,n=t.length;r<n;r++)e=t[r],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);let a=!1;for(;!a;)for(a=!0,r=0,n=i.length;r<n;r++)r+1<n&&1===q(i[r],i[r+1])&&(o=i[r],i[r]=i[r+1],i[r+1]=o,a=!1);for(r=0,n=i.length;r<n;r++)e=i[r],e.pos=r;for(r=0,n=i.length;r<n;r++)e=i[r],e.left||(o=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=o);return i}(t),i={},a=[];let s;for(r=0,n=o.length;r<n;r++){if(i[r])continue;const t=[[]];o[r].isExteriorRing?2===e&&!o[r].isSubject&&a.length>1?a[a.length-1].push(t[0]):a.push(t):2!==e||o[r].isSubject||0!==a.length?0===a.length?a.push([[t]]):a[a.length-1].push(t[0]):a.push(t);const n=a.length-1;let u=r;const l=o[r].point;for(t[0].push(l);u>=r;)s=o[u],i[u]=!0,s.left?(s.resultInOut=!1,s.contourId=n):(s.otherEvent.resultInOut=!0,s.otherEvent.contourId=n),u=s.pos,i[u]=!0,t[0].push(o[u].point),u=$(u,o,i,r);u=-1===u?r:u,s=o[u],i[u]=i[s.pos]=!0,s.otherEvent.resultInOut=!0,s.otherEvent.contourId=n}return a}var Q=W,U=W;function W(t,e){if(!(this instanceof W))return new W(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||X,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function X(t,e){return t<e?-1:t>e?1:0}W.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var o=t-1>>1,i=e[o];if(r(n,i)>=0)break;e[t]=i,t=o}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,o=e[t];t<n;){var i=1+(t<<1),a=i+1,s=e[i];if(a<this.length&&r(e[a],s)<0&&(i=a,s=e[a]),r(s,o)>=0)break;e[t]=s,t=i}e[t]=o}},Q.default=U;const Y=Math.max,Z=Math.min;let tt=0;function et(t,e,r,n,o,i){let a,s,u,l,h,f;for(a=0,s=t.length-1;a<s;a++){if(u=t[a],l=t[a+1],h=new N(u,!1,void 0,e),f=new N(l,!1,h,e),h.otherEvent=f,u[0]===l[0]&&u[1]===l[1])continue;h.contourId=f.contourId=r,i||(h.isExteriorRing=!1,f.isExteriorRing=!1),q(h,f)>0?f.left=!0:h.left=!0;const s=u[0],c=u[1];o[0]=Z(o[0],s),o[1]=Z(o[1],c),o[2]=Y(o[2],s),o[3]=Y(o[3],c),n.push(h),n.push(f)}}const rt=[];function nt(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);let n=function(t,e,r){let n=null;return t.length*e.length==0&&(0===r?n=rt:2===r?n=t:1!==r&&3!==r||(n=0===t.length?e:t)),n}(t,e,r);if(n)return n===rt?null:n;const o=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],a=function(t,e,r,n,o){const i=new Q(null,q);let a,s,u,l,h,f;for(u=0,l=t.length;u<l;u++)for(a=t[u],h=0,f=a.length;h<f;h++)s=0===h,s&&tt++,et(a[h],!0,tt,i,r,s);for(u=0,l=e.length;u<l;u++)for(a=e[u],h=0,f=a.length;h<f;h++)s=0===h,2===o&&(s=!1),s&&tt++,et(a[h],!1,tt,i,n,s);return i}(t,e,o,i,r);return n=function(t,e,r,n,o){let i=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(0===o?i=rt:2===o?i=t:1!==o&&3!==o||(i=t.concat(e))),i}(t,e,o,i,r),n?n===rt?null:n:H(function(t,e,r,n,o,i){const a=new C(K),s=[],u=Math.min(n[2],o[2]);let l,h,f;for(;0!==t.length;){let e=t.pop();if(s.push(e),0===i&&e.point[0]>u||2===i&&e.point[0]>n[2])break;if(e.left){h=l=a.insert(e),f=a.minNode(),l=l!==f?a.prev(l):null,h=a.next(h);const r=l?l.key:null;let n;if(L(e,r,i),h&&2===J(e,h.key,t)&&(L(e,r,i),L(e,h.key,i)),l&&2===J(l.key,e,t)){let t=l;t=t!==f?a.prev(t):null,n=t?t.key:null,L(r,n,i),L(e,r,i)}}else e=e.otherEvent,h=l=a.find(e),l&&h&&(l=l!==f?a.prev(l):null,h=a.next(h),a.remove(e),h&&l&&J(l.key,h.key,t))}return s}(a,0,0,o,i,r),r)}var ot=T(P((function(t,e){var r=k&&k.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var n=r(nt);e.default=function t(e,r,o){void 0===o&&(o={});var i=S.getGeom(e),a=S.getGeom(r);if("Polygon"===i.type&&"Polygon"===a.type){var s=n.intersection(i.coordinates,a.coordinates);if(null===s||0===s.length)return null;if(1===s.length){var u=s[0][0][0],l=s[0][0][s[0][0].length-1];return u[0]===l[0]&&u[1]===l[1]?O.polygon(s[0],o.properties):null}return O.multiPolygon(s,o.properties)}if("MultiPolygon"===i.type){for(var h=[],f=0,c=i.coordinates;f<c.length;f++){var g=c[f],p=t(S.getGeom(O.polygon(g)),a);if(p){var d=S.getGeom(p);if("Polygon"===d.type)h.push(d.coordinates);else{if("MultiPolygon"!==d.type)throw new Error("intersection is invalid");h=h.concat(d.coordinates)}}}return 0===h.length?null:1===h.length?O.polygon(h[0],o.properties):O.multiPolygon(h,o.properties)}if("MultiPolygon"===a.type)return t(a,i);throw new Error("poly1 and poly2 must be either polygons or multiPolygons")}})));function it(t,e,r){let n=[],o=[],i=[],a=[1e8,1e8,-1e8,-1e8];t.features.forEach(t=>{n.push(t.properties[e]),o.push(t.geometry.coordinates[0]),i.push(t.geometry.coordinates[1]),a[0]>t.geometry.coordinates[0]&&(a[0]=t.geometry.coordinates[0]),a[1]>t.geometry.coordinates[1]&&(a[1]=t.geometry.coordinates[1]),a[2]<t.geometry.coordinates[0]&&(a[2]=t.geometry.coordinates[0]),a[3]<t.geometry.coordinates[1]&&(a[3]=t.geometry.coordinates[1])});let s=_.train(n,o,i,r.model,r.sigma2,r.alpha);return _.getGridInfo(a,s,200)}t.drawCanvasContour=function(t,e,r,n,o,i,a){let s=it(t,e,r);_.drawCanvasContour(s,n,o,i,a)},t.getVectorContour=function(t,e,r,n,o){let i=it(t,e,r),a=_.getVectorContour(i,n);if(o){let t=[];a.features.forEach(e=>{let r=ot(e,o);r&&(r.properties=e.properties,t.push(r))}),a.features=t}return a},Object.defineProperty(t,"__esModule",{value:!0})}));
